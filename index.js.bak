var postcss = require( 'postcss' );

var fontstackConfig = {
	Arial: 'Arial, "Helvetica Neue", Helvetica, sans-serif',
};

module.exports = postcss.plugin( 'bassline', function(options) {
	function toTitleCase( str ) {
		return str.replace( /\w\S*/g, function( txt ) {
			return txt.charAt( 0 ).toUpperCase() + txt.substr( 1 ).toLowerCase();
		});
	}
	return function( css ) {
		options = options || {};

		css.walkRules( function( rule ) {
			rule.walkDecls( function( decl, i ) {
				var value = decl.value;

				if ( value.indexOf( 'fontstack(' ) !== -1 ) {
					var first_font = value.substr(0, value.indexOf('fontstack('));
					var fontstackRequested = value.match(/\(([^)]+)\)/)[1].replace(/["']/g, "");
					fontstackRequsted = toTitleCase( fontstackRequested );
					fontstack = fontstackConfig[fontstackRequested];
					var new_value = first_font + fontstack;
					decl.value = new_value;
				}
			});
		});
	}
});
